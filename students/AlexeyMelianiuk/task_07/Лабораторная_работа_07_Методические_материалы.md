# Лабораторная работа 07 — Методические материалы

Темы: тесты API, кэш/ETag, обработка ошибок/устойчивость, оптимизация.

1. Тесты
- Создайте тестовый проект: `dotnet new xunit -n Task07.Tests`; добавьте ссылку на Web/API.
- Подключите Moq или NSubstitute. Напишите 3–5 тестов контроллера: коды 200/404, сериализация ответов, негативные сценарии.

2. Кэш и ETag
- Включите ResponseCaching: builder.Services.AddResponseCaching(); app.UseResponseCaching();
- Для GET добавьте заголовки Cache-Control и вычисляйте ETag (например, хеш содержимого). При совпадении If-None-Match возвращайте 304.

3. Обработка ошибок и устойчивость
- Добавьте middleware глобальных ошибок, формируйте ProblemDetails (type, title, status, detail, instance) и correlation id (TraceIdentifier).
- Подключите Polly (HttpClientFactory): добавьте политику retry/timeout для вызова внешнего сервиса.

4. Оптимизация
- Включите сжатие ответов (ResponseCompression). Настройте JsonSerializerOptions.PropertyNamingPolicy = CamelCase; DefaultIgnoreCondition = WhenWritingNull.
- Измерьте простой p95: 100 запросов k6/JMeter/Autocannon, сравните до/после одной оптимизации.

5. Отчёт
- В `students/<id>/task_07/doc/readme.md`: примеры ProblemDetails, скриншоты 304, метрики.

6. Запуск
- `dotnet test` — прогон тестов
- `dotnet run --project <ваш API>` — ручная проверка кэша/ETag и ошибок
